---
layout: default
---
<article class="gallery">
  <header class="gallery-header">
    <h1 class="gallery-title">{{ page.title | escape }}</h1>
    {% if page.description %}
      <p class="gallery-description">{{ page.description }}</p>
    {% endif %}
  </header>

  <div class="gallery-content">
    {{ content }}
    
    {% if page.gallery_path %}
      <div class="photo-grid">
        {% assign image_files = site.static_files | where_exp: "file", "file.path contains page.gallery_path" %}
        {% for image in image_files %}
          <div class="photo-item">
            <img src="{{ image.path | relative_url }}" alt="{{ image.name }}" loading="lazy">
          </div>
        {% else %}
          <p>No images found in the specified gallery path.</p>
        {% endfor %}
      </div>
    {% else %}
      <p>No gallery path specified.</p>
    {% endif %}
  </div>
</article>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const grid = document.querySelector('.photo-grid');
  const items = Array.from(grid.querySelectorAll('.photo-item'));
  const gridGap = 20; // Should match the grid-gap in CSS
  const columnWidth = 200; // Should match the minmax value in CSS

  function handleImage(item) {
    return new Promise((resolve) => {
      const img = item.querySelector('img');
      if (img.complete) {
        setImageSize(item, img);
        resolve(item);
      } else {
        img.onload = () => {
          setImageSize(item, img);
          resolve(item);
        };
      }
    });
  }

  function setImageSize(item, img) {
    const ratio = img.naturalWidth / img.naturalHeight;
    item.ratio = ratio;
    
    if (ratio > 1.3) {  // Landscape images
      item.style.gridColumnEnd = "span 2";
    } else if (ratio < 0.7) {  // Portrait images
      item.style.gridRowEnd = "span 2";
    }
    
    // For very wide panoramas
    if (ratio > 2) {
      item.style.gridColumnEnd = "span 3";  // Span 3 columns instead of all
    }

    // Calculate the height based on the width and original aspect ratio
    const width = item.offsetWidth;
    const height = width / ratio;
    item.style.height = `${height}px`;
  }

  function resizeGrid() {
    const containerWidth = grid.offsetWidth;
    const numColumns = Math.floor((containerWidth + gridGap) / (columnWidth + gridGap));
    grid.style.gridTemplateColumns = `repeat(${numColumns}, 1fr)`;
    
    const columns = Array(numColumns).fill(0);
    
    items.forEach(item => {
      const columnSpan = item.style.gridColumnEnd.split(' ')[1] || 1;
      const rowSpan = item.style.gridRowEnd.split(' ')[1] || 1;
      
      // Find the column with the smallest height
      let smallestColumn = columns.indexOf(Math.min(...columns));
      
      // If the item spans multiple columns, make sure there's enough space
      if (columnSpan > 1) {
        for (let i = smallestColumn; i < smallestColumn + columnSpan; i++) {
          if (i >= numColumns || (i > smallestColumn && columns[i] > columns[smallestColumn])) {
            smallestColumn++;
            i = smallestColumn - 1;
          }
        }
      }
      
      item.style.gridColumnStart = smallestColumn + 1;
      item.style.gridRowStart = columns[smallestColumn] + 1;
      
      // Update the height of the affected columns
      for (let i = smallestColumn; i < smallestColumn + columnSpan; i++) {
        columns[i] = columns[smallestColumn] + rowSpan;
      }
    });
  }

  Promise.all(items.map(handleImage)).then(() => {
    resizeGrid();
    window.addEventListener('resize', resizeGrid);
  });
});
</script>
<style>
.photo-grid {
  display: grid;
  grid-gap: 20px;
  padding: 20px;
}

.photo-item {
  position: relative;
  overflow: hidden;
  background-color: #f0f0f0; /* Light grey background */
}

.photo-item img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

@media (max-width: 600px) {
  .photo-grid {
    grid-template-columns: 1fr !important;
  }
  
  .photo-item {
    grid-column: auto !important;
    grid-row: auto !important;
  }
}
</style>